name: PR Check

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  # ===== PR TITLE CHECK =====
  pr-title:
    name: PR Title Check
    runs-on: ubuntu-latest
    steps:
      - name: Check PR title
        uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          types: |
            feat
            fix
            docs
            style
            refactor
            test
            chore
            ci
            perf
            revert
            build
          requireScope: false
          subjectPattern: ^[a-z].+$
          subjectPatternError: |
            The subject "{subject}" found in the pull request title "{title}"
            doesn't match the configured pattern. Please use lowercase.

  # ===== SIZE LABEL =====
  size-label:
    name: Add Size Label
    runs-on: ubuntu-latest
    steps:
      - name: Add size label
        uses: codelytv/pr-size-labeler@v1
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          xs_label: 'size/xs'
          xs_max_size: 10
          s_label: 'size/s'
          s_max_size: 100
          m_label: 'size/m'
          m_max_size: 500
          l_label: 'size/l'
          l_max_size: 1000
          xl_label: 'size/xl'
          fail_if_xl: false

  # ===== CONFLICT CHECK =====
  conflict-check:
    name: Check for Conflicts
    runs-on: ubuntu-latest
    steps:
      - name: Check for merge conflicts
        uses: eps1lon/actions-label-merge-conflict@releases/2.x
        with:
          dirtyLabel: 'conflict'
          repoToken: ${{ secrets.GITHUB_TOKEN }}

  # ===== BRANCH NAME CHECK =====
  branch-name:
    name: Branch Name Check
    runs-on: ubuntu-latest
    steps:
      - name: Check branch name
        uses: deepakputhraya/action-branch-name@master
        with:
          regex: '^(feature|bugfix|hotfix|release|refactor|docs|chore)\/[a-z0-9._-]+$'
          allowed_prefixes: 'feature,bugfix,hotfix,release,refactor,docs,chore'
          ignore: main,develop
          min_length: 5
          max_length: 50


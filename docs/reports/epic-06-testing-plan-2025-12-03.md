# Epic 6: Payments - –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞:** 2025-12-03
**–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫:** AI Assistant
**–°—Ç–∞—Ç—É—Å:** ‚è≥ **–ì–û–¢–û–í –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ**

---

## üìä –°–≤–æ–¥–∫–∞

### Epic 6: Payments

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ Stripe –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ –∑–∞–∫–∞–∑—ã.

**User Stories:**
- US-029: –°–æ–∑–¥–∞–Ω–∏–µ Payment Intent
- US-030: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- US-031: –û–±—Ä–∞–±–æ—Ç–∫–∞ Stripe Webhook
- US-032: –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- ‚úÖ Epic 1: Authentication (Keycloak –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- ‚úÖ Epic 5: Orders (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)

---

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Swagger UI

**–°—Ç–∞—Ç—É—Å:** ‚è≥ **–í –ü–†–û–¶–ï–°–°–ï**

#### Endpoints –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. ‚úÖ `POST /api/payments/intent` - –°–æ–∑–¥–∞–Ω–∏–µ Payment Intent (client)
2. ‚úÖ `GET /api/payments/my` - –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π (client)
3. ‚úÖ `GET /api/payments/:id` - –î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞
4. ‚úÖ `POST /api/payments/webhook` - Webhook –æ—Ç Stripe (–ø—É–±–ª–∏—á–Ω—ã–π)

---

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Keycloak —Ç–æ–∫–µ–Ω–∞–º–∏

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- ‚úÖ Keycloak –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –¢–æ–∫–µ–Ω—ã –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å
- ‚è≥ –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã (PENDING —Å—Ç–∞—Ç—É—Å)
- ‚è≥ Stripe test mode –Ω–∞—Å—Ç—Ä–æ–µ–Ω

#### –¢–µ—Å—Ç—ã:

1. **US-029: –°–æ–∑–¥–∞–Ω–∏–µ Payment Intent**
   - ‚è≥ –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω client
   - ‚è≥ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ (PENDING)
   - ‚è≥ –°–æ–∑–¥–∞—Ç—å Payment Intent –¥–ª—è –∑–∞–∫–∞–∑–∞
   - ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç (client_secret, payment_intent_id)

2. **US-032: –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π**
   - ‚è≥ –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω client
   - ‚è≥ –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π
   - ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é

3. **US-030: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞**
   - ‚è≥ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Stripe test mode
   - ‚è≥ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ Stripe
   - ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

4. **US-031: Stripe Webhook**
   - ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook endpoint
   - ‚è≥ –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å webhook –æ—Ç Stripe
   - ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É

---

## ‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ù—É–∂–Ω–æ:**
- –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º PENDING
- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ API

### 2. Stripe Configuration

**–ù—É–∂–Ω–æ:**
- `STRIPE_SECRET_KEY` (test key)
- `STRIPE_WEBHOOK_SECRET` (–¥–ª—è webhook)
- Stripe test mode –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω

### 3. Keycloak —Ç–æ–∫–µ–Ω—ã

**–î–æ—Å—Ç—É–ø–Ω—ã:**
- ‚úÖ client1@test.com / password123 (client)
- ‚úÖ vendor1@test.com / password123 (vendor)
- ‚úÖ admin@mementomori.de / admin123 (admin)

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Swagger UI –¥–ª—è Payments endpoints
2. ‚è≥ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ (–µ—Å–ª–∏ –Ω–µ—Ç)
3. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ Payment Intent
4. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π
5. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Stripe –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-03


# Epic 6: Payments - –ü—Ä–æ–≤–µ—Ä–∫–∞ Swagger UI

**–î–∞—Ç–∞:** 2025-12-03
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **SWAGGER UI –ü–†–û–í–ï–†–ï–ù**

---

## üìä –°–≤–æ–¥–∫–∞

### Endpoints –≤ Swagger UI

| Endpoint                   | Method | –†–æ–ª—å                | –û–ø–∏—Å–∞–Ω–∏–µ                 |
| -------------------------- | ------ | ------------------- | ------------------------ |
| `/api/payments/intent`     | POST   | client              | –°–æ–∑–¥–∞–Ω–∏–µ Payment Intent  |
| `/api/payments/my`         | GET    | client              | –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –∫–ª–∏–µ–Ω—Ç–∞ |
| `/api/payments`            | GET    | admin               | –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ (admin)      |
| `/api/payments/:id`        | GET    | client/vendor/admin | –î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞           |
| `/api/payments/:id/refund` | POST   | admin               | –í–æ–∑–≤—Ä–∞—Ç –ø–ª–∞—Ç–µ–∂–∞          |

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Swagger UI

### 1. POST /api/payments/intent

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–û–¢–û–ë–†–ê–ñ–ê–ï–¢–°–Ø –í SWAGGER**

- ‚úÖ Endpoint –≤–∏–¥–µ–Ω –≤ Swagger UI
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Bearer token)
- ‚úÖ –†–æ–ª—å: `client`
- ‚úÖ DTO: `CreatePaymentIntentDto` (orderId)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

- ‚è≥ –¢—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω client
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∑–∞–∫–∞–∑ (PENDING —Å—Ç–∞—Ç—É—Å)

---

### 2. GET /api/payments/my

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–û–¢–û–ë–†–ê–ñ–ê–ï–¢–°–Ø –í SWAGGER**

- ‚úÖ Endpoint –≤–∏–¥–µ–Ω –≤ Swagger UI
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Bearer token)
- ‚úÖ –†–æ–ª—å: `client`
- ‚úÖ Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `status`, `page`, `limit`

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

- ‚è≥ –¢—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω client
- ‚è≥ –ú–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö (–≤–µ—Ä–Ω–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫)

---

### 3. GET /api/payments

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–û–¢–û–ë–†–ê–ñ–ê–ï–¢–°–Ø –í SWAGGER**

- ‚úÖ Endpoint –≤–∏–¥–µ–Ω –≤ Swagger UI
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Bearer token)
- ‚úÖ –†–æ–ª—å: `admin`
- ‚úÖ Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `status`, `clientId`, `page`, `limit`

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

- ‚è≥ –¢—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω admin

---

### 4. GET /api/payments/:id

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–û–¢–û–ë–†–ê–ñ–ê–ï–¢–°–Ø –í SWAGGER**

- ‚úÖ Endpoint –≤–∏–¥–µ–Ω –≤ Swagger UI
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Bearer token)
- ‚úÖ –†–æ–ª–∏: `client`, `vendor`, `admin`
- ‚úÖ Path –ø–∞—Ä–∞–º–µ—Ç—Ä: `id` (UUID)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

- ‚è≥ –¢—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π payment ID

---

### 5. POST /api/payments/:id/refund

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–û–¢–û–ë–†–ê–ñ–ê–ï–¢–°–Ø –í SWAGGER**

- ‚úÖ Endpoint –≤–∏–¥–µ–Ω –≤ Swagger UI
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Bearer token)
- ‚úÖ –†–æ–ª—å: `admin`
- ‚úÖ Path –ø–∞—Ä–∞–º–µ—Ç—Ä: `id` (UUID)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

- ‚è≥ –¢—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω admin
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π payment ID

---

### 6. POST /api/payments/webhook

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–°–ö–†–´–¢ –ò–ó SWAGGER** (–ø–æ –¥–∏–∑–∞–π–Ω—É)

- ‚ö†Ô∏è Endpoint —Å–∫—Ä—ã—Ç –∏–∑ Swagger (`@ApiExcludeEndpoint()`)
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π endpoint (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- ‚úÖ –î–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Stripe

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - webhook endpoints –æ–±—ã—á–Ω–æ —Å–∫—Ä—ã—Ç—ã –∏–∑ –ø—É–±–ª–∏—á–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### Keycloak —Ç–æ–∫–µ–Ω—ã

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

| Email                | Password    | –†–æ–ª—å   | –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è      |
| -------------------- | ----------- | ------ | --------------------- |
| client1@test.com     | password123 | client | ‚úÖ Payments endpoints |
| admin@mementomori.de | admin123    | admin  | ‚úÖ Admin endpoints    |

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–±–µ–∑ Stripe)

1. ‚úÖ –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω client —á–µ—Ä–µ–∑ `POST /api/auth/login`
2. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `GET /api/payments/my` (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫)
3. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (401 –±–µ–∑ —Ç–æ–∫–µ–Ω–∞)

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∑–∞–∫–∞–∑–æ–º

1. ‚è≥ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ `POST /api/orders`
2. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `POST /api/payments/intent` —Å orderId
3. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç (clientSecret, paymentId)

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Stripe (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

1. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `STRIPE_SECRET_KEY` –≤ .env
2. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ Payment Intent
3. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å webhook –æ–±—Ä–∞–±–æ—Ç–∫—É

---

## ‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω–æ:

1. ‚úÖ Keycloak –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ –¢–æ–∫–µ–Ω—ã –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å
3. ‚è≥ –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ (PENDING —Å—Ç–∞—Ç—É—Å)
4. ‚è≥ Stripe test mode (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## ‚úÖ –ò—Ç–æ–≥–∏

**Swagger UI –ø—Ä–æ–≤–µ—Ä–µ–Ω:**

- ‚úÖ –í—Å–µ endpoints –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ DTOs –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –†–æ–ª–∏ —É–∫–∞–∑–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:**

- ‚úÖ –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Swagger UI
- ‚úÖ Keycloak —Ç–æ–∫–µ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚è≥ –ù—É–∂–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-03

# Интеграция Keycloak с Frontend

## Текущее состояние

### ✅ Что работает сейчас:

1. **Backend интеграция:**
   - Backend API (`/auth/login`, `/auth/register`) интегрирован с Keycloak
   - При логине/регистрации backend автоматически использует Keycloak
   - Если Keycloak недоступен - используется локальная аутентификация (fallback)

2. **Frontend приложения:**
   - Client (apps/client) - использует `/auth/login` и `/auth/register`
   - Admin Portal (apps/admin-portal) - использует `/auth/login`
   - Vendor Portal (apps/vendor-portal) - использует `/auth/login`

### ⚠️ Текущая схема работы:

```
Frontend (форма) → Backend API → Keycloak → Backend → Frontend (токен)
```

**Плюсы:**
- ✅ Работает "из коробки" - не нужно менять frontend
- ✅ Единая точка входа через backend
- ✅ Fallback на локальную аутентификацию

**Минусы:**
- ⚠️ Нет прямого использования Keycloak UI
- ⚠️ Нет SSO (Single Sign-On) между приложениями
- ⚠️ Нет использования Keycloak функций (2FA, социальные сети и т.д.)

## Варианты интеграции

### Вариант 1: Текущий (уже работает) ✅

**Как работает:**
- Пользователь вводит email/password в форме
- Frontend отправляет на `/auth/login`
- Backend аутентифицирует через Keycloak
- Возвращает токен

**Статус:** ✅ Работает сейчас

### Вариант 2: Прямая интеграция с Keycloak (рекомендуется для продакшена)

**Как работает:**
- Использование Keycloak JS Adapter
- Редирект на Keycloak для логина
- Keycloak возвращает токен
- Frontend использует токен для API запросов

**Преимущества:**
- ✅ Полный доступ к функциям Keycloak (2FA, социальные сети)
- ✅ SSO между приложениями
- ✅ Единый UI для логина
- ✅ Более безопасно

**Недостатки:**
- ⚠️ Требует изменений во frontend
- ⚠️ Нужно настроить Keycloak клиенты для каждого frontend приложения

## Рекомендации

### Для разработки:
**Используйте текущую схему** - она уже работает и не требует изменений во frontend.

### Для продакшена:
**Рекомендуется добавить прямую интеграцию** с Keycloak для:
- SSO между приложениями
- Использования всех функций Keycloak
- Улучшенной безопасности

## Текущие endpoints

### Client (apps/client)
- Логин: `/auth/signin` → `POST /auth/login`
- Регистрация: `/auth/register` → `POST /auth/register`

### Admin Portal (apps/admin-portal)
- Логин: `/auth/login` → `POST /auth/login`

### Vendor Portal (apps/vendor-portal)
- Логин: `/auth/login` → `POST /auth/login`

## Проверка работы

Текущая интеграция работает следующим образом:

1. Пользователь заполняет форму логина
2. Frontend отправляет запрос на backend
3. Backend пытается аутентифицировать через Keycloak
4. Если пользователь существует в Keycloak - возвращается Keycloak токен
5. Если нет - используется локальная аутентификация

**Для тестирования:**
1. Создайте пользователя в Keycloak Admin Console
2. Попробуйте войти через форму логина
3. Должен вернуться Keycloak токен

## Заключение

✅ **Текущая интеграция работает** - кнопки логина/регистрации уже подключены к Keycloak через backend.

⚠️ **Для полной интеграции** можно добавить прямую работу с Keycloak JS Adapter, но это опционально и не обязательно для работы системы.


# Epic 1: Authentication & Authorization (MVP)

**Phase:** MVP  
**Portal:** Backend  
**Module:** AuthModule  
**Epic ID:** E-001

---

## Описание

Реализация базовой системы аутентификации и авторизации для платформы. Включает регистрацию пользователей (Client, Vendor), логин/логаут, JWT токены и базовую RBAC систему.

---

## Функциональность

- Регистрация Client пользователей
- Регистрация Vendor пользователей
- Логин/Logout
- JWT токены (access tokens)
- RBAC (Role-Based Access Control) - базовый
- Защита endpoints через Guards

**Исключено из MVP:**
- Refresh tokens
- Password reset
- Email verification
- OAuth интеграции

---

## Зависимости

**Предшествующие эпики:** Нет (стартовый эпик)

**Требует завершения:**
- Нет

**Блокирует:**
- Epic 2: Vendors Management
- Epic 9: Client App - Authentication
- Epic 13: Vendor Portal - Authentication
- Epic 16: Admin Portal - Authentication

---

## Приоритет (MoSCoW)

**Must Have** - Критичный для MVP

Без аутентификации невозможно работать с платформой. Это основа для всех остальных модулей.

---

## Story Points

**Оценка:** 13 points

**Обоснование:**
- Регистрация (Client + Vendor): 3 points
- Логин/Logout: 2 points
- JWT токены: 3 points
- RBAC система: 3 points
- Guards и декораторы: 2 points

---

## Последовательность разработки

**Порядок:** 1 (первый эпик)

**Последовательность:**
1. Настройка AuthModule и базовой структуры
2. Регистрация Client пользователей
3. Регистрация Vendor пользователей
4. Логин/Logout
5. JWT токены
6. RBAC система
7. Guards и декораторы

---

## Параллельная разработка

**Возможна параллельная работа:**
- ✅ Frontend команда может начать работу над UI после определения API контракта
- ✅ Можно работать параллельно над Client и Vendor регистрацией

**Не может быть параллельной:**
- ❌ Другие backend модули не могут начаться без Auth
- ❌ Frontend не может интегрироваться без готового API

---

## Критерии готовности (Definition of Done)

- [ ] Регистрация Client пользователей работает
- [ ] Регистрация Vendor пользователей работает
- [ ] Логин/Logout работает
- [ ] JWT токены генерируются и валидируются
- [ ] RBAC система работает (CLIENT, VENDOR, ADMIN роли)
- [ ] Guards защищают endpoints
- [ ] Unit тесты написаны (покрытие > 80%)
- [ ] API документация обновлена
- [ ] Code review пройден

---

## User Stories (примеры)

1. **Как Client**, я хочу зарегистрироваться на платформе, чтобы получить доступ к услугам
2. **Как Vendor**, я хочу зарегистрироваться на платформе, чтобы размещать свои услуги
3. **Как пользователь**, я хочу войти в систему, чтобы получить доступ к моему профилю
4. **Как система**, я должна защищать endpoints от неавторизованного доступа

---

## Технические детали

**Технологии:**
- NestJS
- @nestjs/jwt
- @nestjs/passport
- bcrypt (для хеширования паролей)

**API Endpoints:**
- `POST /auth/register` - Регистрация Client
- `POST /auth/register/vendor` - Регистрация Vendor
- `POST /auth/login` - Логин
- `POST /auth/logout` - Logout

**Database:**
- User model (Prisma)
- Role enum (CLIENT, VENDOR, ADMIN)

---

## Риски и митигация

**Риски:**
- Сложность интеграции JWT с фронтендом
- Безопасность токенов

**Митигация:**
- Раннее определение API контракта
- Использование проверенных библиотек
- Security review

---

## Примечания

Это критичный эпик, который блокирует все остальные. Рекомендуется начать с него и завершить как можно раньше.

